---
- name: mkdir -pv ~/dotfiles
  file: path=~/dotfiles state=directory

- name: rm -fv ~/dotfiles/*~
  shell: rm -fv ~/dotfiles/*~

- name: ~/.profile
  template: src=profile.j2 dest={{ test_path }}/profile backup=yes
  tags:
    - bash

- name: ~/.shrc
  template: src=shrc.j2  dest={{ test_path }}/shrc backup=yes
  tags:
    - bash

- name: ~/.bashrc
  template: src=bashrc.j2  dest={{ test_path }}/bashrc backup=yes
  tags:
    - bash

- name: ~/.zshrc
  copy: src=zshrc dest={{ test_path }}/zshrc backup=yes
  tags:
    - bash

- name: ~/.vimrc
  template: src=vimrc.j2 dest={{ test_path }}/vimrc backup=yes
  tags:
    - vim

- name: Check emacs verson
  shell: emacs --version|head -n 1|awk '{print $3}'
  register: emacs_version
  tags:
    - emacs

- debug: var=emacs_version.stdout_lines
  when: test | default(false) | bool
  tags:
    - emacs

- debug: var=emacs_version.stdout.strip()
  when: test | default(false) | bool
  tags:
    - emacs

- name: ~/.emacs
  template: src=emacs.j2 dest={{ test_path }}/emacs backup=yes
  tags:
    - emacs

- name: Check tmux verson
  command: tmux -V
  register: tmux_version
  tags:
    - tmux

- name: Add as Fact for tmux version
  set_fact:
    version: "{{ tmux_version.stdout.strip().split()[1] }}"
  tags:
    - tmux

- debug: var=tmux_version.stdout_lines
  when: test | default(false) | bool
  #tags:
  #  - v
- debug: var=tmux_version.stdout.strip()
  when: test | default(false) | bool
  #tags:
  #  - v
- debug: var=tmux_version.stdout.strip().split()[1]
  when: test | default(false) | bool
  #tags:
  #  - v
- debug: var=version
  when: test | default(false) | bool
  #tags:
  #  - v

- name: ~/.tmux.conf
  template: src=tmux.conf.j2 dest={{ test_path }}/tmux.conf backup=yes
  tags:
    - tmux

- name: ~/.pythonstartup
  copy: src=pythonstartup dest={{ test_path }}/pythonstartup backup=yes
  tags:
    - pystartup

- name: ~/dotfiles/create.links.sh
  copy: src=create.links.sh dest={{ test_path }}/create.links.sh backup=yes
  tags:
    - script

- name: ~/dotfiles/screenrc
  copy: src=screenrc  dest={{ test_path }}/screenrc backup=yes

- name: ~/dotfiles/gitconfig
  copy: src=gitconfig  dest={{ test_path }}/gitconfig backup=yes

- name: ~/dotfiles/gitignore
  copy: src=gitignore dest={{ test_path }}/gitignore backup=yes

- name: ~/dotfiles/Xdefaults
  copy: src=Xdefaults dest={{ test_path }}/Xdefaults backup=yes
  when: desk | default(false) | bool

- name: ~/dotfiles/pentadactylrc
  copy: src=pentadactylrc dest={{ test_path }}/pentadactylrc backup=yes
  when: desk | default(false) | bool

- name: ~/dotfiles/vimperatorrc
  copy: src=vimperatorrc dest={{ test_path }}/vimperatorrc backup=yes
  when: desk | default(false) | bool

- name: ~/dotfiles/fonts.conf
  copy: src=fonts.conf dest={{ test_path }}/fonts.conf backup=yes
  when: desk | default(false) | bool

## ansible default generate config mode : 660 -rw-rw-r--
- name: find ~/dotfiles -type f | xargs chmod 640
  shell: find ~/dotfiles -type f | xargs chmod 640

### XXX test NO BackUp task executed only specify option : -e "test=true"
#- name:  test config
#  template: src={{ item.src }} dest={{ item.dest }}
#  when: test | default(false) | bool
#  with_items:
#    - { src: hello.cfg.j2, dest: /root/hello.cfg }
#    - { src: hello.cfg.j2, dest: /root/hello.cfg }
